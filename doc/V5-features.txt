Supervisor Firmware V5 features.	2019-11-06 KSTR

V5.x firmware is primarily intedend to be used with V7.1 hardware but it was attempted
to remain fully compatible to V6 & V7 hardware and older Firmwares for BBB and LPC
(full testing tbd).


1) Muting Control via LPC control line.
A GPIO Pin (Port A3) is sensed for a continuously applied square-wave of 10Hz (100ms), +-10%.
A duty cycle of 70%+-10% (70ms high, 30ms low) is interpreted as "unmute request", and
a duty cycle of 30%+-10% is interpreted as "mute request".
The detector is integrating, 3 repeated constant patterns must be applied to cause changes.
Therefore, reaction time is about 400ms.
Unknown patterns (frequency and duty cycle), including noise and DC, will cause the default
unmuting strategy will be used, which is a fixed timeout after power-up (~30seconds).

The LPC Muting Control can be overriden by commands via the BBB Command&Status Interface.


2) BBB Command&Status Interface (only available with Uniboard Rev 7.1 and later, and with V7 Uniboards
after rework) :
A USART (async. serial interface) connection is used between Supervisor and BBB ('tty5', !!needs two
wires to be patched on BBB's "H8"-Pinheader!!).
Setup is : 300bps, 8 data bits, 1 stop bit, no parity.

2a) Supervisor contiuously sends a 3-byte sequence: Status Byte, Hardware-ID, Firmware-ID:
	- Status Byte
		Bit 7 	: always == 1 (delimiter)
		Bit 6&5	: Supervisor Status (00:Standby, 01:Booting, 10:Running, 11:Shutdown)
		Bit 4	: Supervisor Power-Button Locked
		Bit 3	: unused (0)
		Bit 2	: Muting Override Enable : Enables overriding of the Audio Muting
		Bit 1	: Muting Override Value : State of the Muting applied by Override (1:unmuted)
		Bit 0	: Current Muting State : Actual state of the audio path relays. 1:unmuted

	- Hardware-ID (uint8), decimal value of the Hardware Version ID of the Uniboard as detected:
		71	: Version 7.1
	
	- Firmware-ID, decimal value of the Firmware Version ID:
		50	: Version 5.0
		

2b) Supervisor accepts 1-byte commands :
	- 'L'/'l'	: enable/disable --Power Button [L]ocking-- (effective only in "Running" or "Booting" mode)
	The Locking is disabled and reset on transtion into "Standby" and "Shutdown" states.
	- 'U'/'u'	: set/reset the state ([U]nmute/[m[u]ute) applied during Muting Override
	- 'O'/'o'	: enable/disable --Muting [O]verride--
	Muting Override is only effective until a non-maskable Muting corrurs, which happens on
	transition into "Shutdown" and "Booting" states, and which also resets the Override.
	

3) In-Service Reprogramming (only available with Uniboard Rev 7.1 and later) :
-- work in progress --
Supervisor now can be reprogrammed on-the-fly from the BBB. The low-level hardware interface
is already tested and consist of the following signals (applied via BBB GPIOs) :
	- Output Enable #1 (toggling line, at 100Hz, more than 200ms)
	- Output Enable #2 (static , neg. logic)
	- PWR (makes sure power remains applied to the whole system, overriding the supervisor)
	- /Reset, SCK, MISO and MOSI, the 4 signals needed to program the IC
	The bracketing sequence to programm is:
		- Set 'PWR'	(enable)
		- Set '/OE2'	(disable)
		- Set '/RST'
		- Start 100Hz toggling sequence on OE1, wait 200ms
		- Clear '/OE2'	(enable)
		- Start Programming
		- Set '/OE2'	(disable)
		- Stop 100Hz toggling on OE1
	If a V5.x Firmware is present, then BBB may request "Power Button Locking" and wait until it is asserted,
	for additional safety.

	
4) Automatic Restart when a Power-Fail event happened during "Booting" and "Running" states:
	- When the latching switch option is used (V7.1 hardware only), this accomplished
	  by this hardware switch right away.
	- When the Push-Button is used (standard in V7&V6, and optional for V7.1), the C15
	  restarts when it was up before the power had failed.
